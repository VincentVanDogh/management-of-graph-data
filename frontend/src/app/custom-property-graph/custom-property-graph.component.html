<div class="upload-data">
  <h3>Upload data (CSV)</h3>

  <!-- Hidden file input -->
  <input
    type="file"
    #fileInput
    accept=".csv"
    multiple
    style="display: none"
    (change)="onFilesSelected($event)"
  />

  <!-- Select files button -->
  <button (click)="fileInput.click()">Select files</button>

  <!-- Selected files list -->
  <ul *ngIf="selectedFiles.length > 0" class="file-list">
    <li *ngFor="let item of selectedFiles; let i = index">

      <div class="file-header">
        <strong>{{ item.file.name }}</strong>
        ({{ item.file.size | number }} bytes)

        <button
          class="remove-btn"
          (click)="removeFile(i)"
          title="Remove file"
        >
          ✕
        </button>
      </div>
    </li>
  </ul>

  <!-- Upload button -->
  <button
    (click)="uploadFiles()"
    [disabled]="selectedFiles.length === 0"
  >
    Upload
  </button>
</div>

<!-- GLOBAL CSV HEADERS -->
<div *ngIf="uniqueHeaders.length > 0" class="csv-headers-section">
  <h3>Detected CSV Headers</h3>

  <table class="csv-header-table">
    <thead>
    <tr>
      <th *ngFor="let header of uniqueHeaders">
        {{ header }}
      </th>
    </tr>
    </thead>
  </table>
</div>

<h3>Node Definition</h3>

<label>Node ID</label>
<select [(ngModel)]="graphSchema.node.idColumn">
  <option [ngValue]="null">-- select --</option>
  <option *ngFor="let h of uniqueHeaders" [value]="h">
    {{ h }}
  </option>
</select>

<label>Node Label</label>
<input type="text" [(ngModel)]="graphSchema.node.label" />

<label>Node Properties</label>
<select
    #propertySelect
    (change)="addNodeProperty(propertySelect.value)"
>
  <option value="" disabled selected>Select property</option>
  <option *ngFor="let h of uniqueHeaders" [value]="h">
    {{ h }}
  </option>
</select>

<div class="chips">
  <span *ngFor="let p of graphSchema.node.properties">
    {{ p }}
    <button (click)="removeNodeProperty(p)">✕</button>
  </span>
</div>

<h3>Edge Schema</h3>

<label>Edge start ID</label>
<select
    #edgeStartSelect
    (change)="graphSchema.edge.startIdColumn = edgeStartSelect.value"
>
  <option value="" disabled selected>Select column</option>
  <option *ngFor="let h of uniqueHeaders" [value]="h">
    {{ h }}
  </option>
</select>

<label>Edge end ID</label>
<select
    #edgeEndSelect
    (change)="graphSchema.edge.endIdColumn = edgeEndSelect.value"
>
  <option value="" disabled selected>Select column</option>
  <option *ngFor="let h of uniqueHeaders" [value]="h">
    {{ h }}
  </option>
</select>

<label>Edge label</label>
<input
  type="text"
  [(ngModel)]="graphSchema.edge.label"
  placeholder="e.g. CONNECTED_BY"
/>

<label>Edge properties</label>
<select
    #edgePropSelect
    (change)="addEdgeProperty(edgePropSelect.value)"
>
  <option value="" disabled selected>Add property</option>
  <option *ngFor="let h of uniqueHeaders" [value]="h">
    {{ h }}
  </option>
</select>

<div class="chips">
  <span *ngFor="let p of graphSchema.edge.properties">
    {{ p }}
    <button (click)="removeEdgeProperty(p)">✕</button>
  </span>
</div>



<div class="past-queries">
  <h3>Past Queries</h3>
  <ul>
    <li *ngFor="let q of pastQueries">
      {{ q }}
    </li>
  </ul>
</div>

<textarea [(ngModel)]="cypherQuery" rows="4"></textarea>

<button (click)="executeQuery(cypherQuery)">Run</button>

<div id="cy"></div>

<div class="graph-wrapper">
  <!-- we will render graph here -->
  <div id="graphContainer"></div>
</div>
